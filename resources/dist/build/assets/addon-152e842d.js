const g={methods:{actionStarted(){this.loading=!0},actionCompleted(e=null,t={}){this.loading=!1,e!==!1&&(this.$events.$emit("clear-selections"),this.$events.$emit("reset-action-modals"),t.message!==!1&&this.$toast.success(t.message||__("Action completed")),this.afterActionSuccessfullyCompleted())},afterActionSuccessfullyCompleted(){this.request()}}},y={data(){return{activeFilterBadges:{},activeFilters:{},activePreset:null,activePresetPayload:{},searchQuery:""}},computed:{activeFilterCount(){let e=Object.keys(this.activeFilters).length;return this.activeFilters.hasOwnProperty("fields")&&(e=e+Object.keys(this.activeFilters.fields).filter(t=>t!="badge").length-1),e},canSave(){return this.isDirty&&this.preferencesPrefix},isDirty(){return this.isFiltering?this.activePreset?this.activePresetPayload.query!=this.searchQuery||!_.isEqual(this.activePresetPayload.filters||{},this.activeFilters):!0:!1},isFiltering(){return!_.isEmpty(this.activeFilters)||this.searchQuery||this.activePreset},hasActiveFilters(){return this.activeFilterCount>0},searchPlaceholder(){return this.activePreset?__("Searching in: ")+this.activePresetPayload.display:__("Search")}},created(){this.$keys.bind("f",e=>{e.preventDefault(),this.handleShowFilters()})},methods:{searchChanged(e){this.searchQuery=e},hasFields(e){for(const t in e)if(e[t])return!0;return!1},filterChanged({handle:e,values:t},s=!0){t&&this.hasFields(t)?Vue.set(this.activeFilters,e,t):Vue.delete(this.activeFilters,e),s&&this.unselectAllItems()},filtersChanged(e){this.activeFilters={};for(const t in e){const s=e[t];this.filterChanged({handle:t,values:s},!1)}this.unselectAllItems()},filtersReset(){this.activePreset=null,this.activePresetPayload={},this.searchQuery="",this.activeFilters={},this.activeFilterBadges={}},unselectAllItems(){this.$refs.dataList&&this.$refs.dataList.clearSelections()},selectPreset(e,t){this.activePreset=e,this.activePresetPayload=t,this.searchQuery=t.query,this.filtersChanged(t.filters)},autoApplyFilters(e){if(!e)return;let t={};e.filter(s=>!_.isEmpty(s.auto_apply)).forEach(s=>{t[s.handle]=s.auto_apply}),this.activeFilters=t}}},P={props:{initialPerPage:{type:Number,default(){return Statamic.$config.get("paginationSize")}}},data(){return{perPage:this.initialPerPage,page:1}},mounted(){this.setInitialPerPage()},methods:{setInitialPerPage(){this.hasPreferences&&(this.perPage=this.getPreference("per_page")||this.initialPerPage)},changePerPage(e){e=parseInt(e),(this.hasPreferences?this.setPreference("per_page",e!=this.initialPerPage?e:null):Promise.resolve()).then(s=>{this.perPage=e,this.resetPage()})},selectPage(e){this.page=e,this.$events.$emit("clear-selections")},resetPage(){this.page=1,this.$events.$emit("clear-selections")}}},$={data(){return{preferencesPrefix:null}},computed:{hasPreferences(){return this.preferencesPrefix!==null}},methods:{preferencesKey(e){return`${this.preferencesPrefix}.${e}`},getPreference(e){return this.$preferences.get(this.preferencesKey(e))},setPreference(e,t){return this.$preferences.set(this.preferencesKey(e),t)},removePreference(e,t=null){return this.$preferences.remove(this.preferencesKey(e),t)}}};function o(e,t,s,i,l,c,h,f){var r=typeof e=="function"?e.options:e;t&&(r.render=t,r.staticRenderFns=s,r._compiled=!0),i&&(r.functional=!0),c&&(r._scopeId="data-v-"+c);var n;if(h?(n=function(a){a=a||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,!a&&typeof __VUE_SSR_CONTEXT__<"u"&&(a=__VUE_SSR_CONTEXT__),l&&l.call(this,a),a&&a._registeredComponents&&a._registeredComponents.add(h)},r._ssrRegister=n):l&&(n=f?function(){l.call(this,(r.functional?this.parent:this).$root.$options.shadowRoot)}:l),n)if(r.functional){r._injectStyles=n;var m=r.render;r.render=function(v,d){return n.call(d),m(v,d)}}else{var u=r.beforeCreate;r.beforeCreate=u?[].concat(u,n):[n]}return{exports:e,options:r}}const S={mixins:[g,y,P,$],props:{initialSortColumn:String,initialSortDirection:String,initialColumns:{type:Array,default:()=>[]},filters:Array,actionUrl:String},data(){return{source:null,initializing:!0,loading:!0,items:[],columns:this.initialColumns,visibleColumns:this.initialColumns.filter(e=>e.visible),sortColumn:this.initialSortColumn,sortDirection:this.initialSortDirection,meta:null,pushQuery:!1,popping:!1}},computed:{parameterMap(){return{sort:"sortColumn",order:"sortDirection",page:"page",perPage:"perPage",search:"searchQuery",filters:"activeFilterParameters",columns:"visibleColumnParameters"}},parameters:{get(){return{...Object.fromEntries(Object.entries(this.parameterMap).map(([t,s])=>[t,this[s]]).filter(([t,s])=>s!=null&&s!=="")),...this.additionalParameters}},set(e){Object.entries(this.parameterMap).forEach(([t,s])=>{e.hasOwnProperty(t)&&(this[s]=e[t])})}},activeFilterParameters:{get(){return _.isEmpty(this.activeFilters)?null:utf8btoa(JSON.stringify(this.activeFilters))},set(e){this.activeFilters=JSON.parse(utf8atob(e))}},visibleColumnParameters:{get(){return _.isEmpty(this.visibleColumns)?null:this.visibleColumns.map(e=>e.field).join(",")},set(e){this.visibleColumns=e.split(",").map(t=>this.columns.find(s=>s.field===t))}},additionalParameters(){return{}},shouldRequestFirstPage(){return this.page>1&&this.items.length===0?(this.page=1,!0):!1}},created(){this.autoApplyFilters(this.filters),this.autoApplyState(),this.request()},mounted(){this.pushQuery&&(window.history.replaceState({parameters:this.parameters},""),window.addEventListener("popstate",this.popState))},beforeDestroy(){this.pushQuery&&window.removeEventListener("popstate",this.popState)},watch:{parameters:{deep:!0,handler(e,t){t.search===e.search&&JSON.stringify(t)!==JSON.stringify(e)&&(this.request(),this.pushState())}},loading:{immediate:!0,handler(e){this.$progress.loading(this.listingKey,e)}},searchQuery(e){this.sortColumn=null,this.sortDirection=null,this.resetPage(),this.request(),this.pushState()}},methods:{request(){if(!this.requestUrl){this.loading=!1;return}this.loading=!0,this.source&&this.source.cancel(),this.source=this.$axios.CancelToken.source(),this.$axios.get(this.requestUrl,{params:this.parameters,cancelToken:this.source.token}).then(e=>{if(this.columns=e.data.meta.columns,this.activeFilterBadges={...e.data.meta.activeFilterBadges},this.items=Object.values(e.data.data),this.meta=e.data.meta,this.shouldRequestFirstPage)return this.request();this.loading=!1,this.initializing=!1,this.afterRequestCompleted(e)}).catch(e=>{this.$axios.isCancel(e)||(this.loading=!1,this.initializing=!1,!(e.request&&!e.response)&&this.$toast.error(e.response?e.response.data.message:__("Something went wrong"),{duration:null}))})},afterRequestCompleted(e){},sorted(e,t){this.sortColumn=e,this.sortDirection=t},removeRow(e){let t=e.id,s=_.indexOf(this.rows,_.findWhere(this.rows,{id:t}));this.rows.splice(s,1),this.rows.length===0&&location.reload()},popState(e){!this.pushQuery||!e.state||(this.popping=!0,this.parameters=e.state.parameters,this.$nextTick(()=>{this.popping=!1}))},pushState(){if(!this.pushQuery||this.popping)return;const e=this.parameters,t=Object.keys(this.parameterMap),s=new URLSearchParams(Object.fromEntries(t.filter(i=>e.hasOwnProperty(i)).map(i=>[i,e[i]])));window.history.pushState({parameters:e},"","?"+s.toString())},autoApplyState(){if(!this.pushQuery||!window.location.search)return;const e=new URLSearchParams(window.location.search),t=Object.fromEntries(e.entries());this.popping=!0,this.parameters=t,this.$nextTick(()=>{this.popping=!1})}}},b=null,C=null;var F=o(S,b,C,!1,null,null,null,null);const w=F.exports,x={props:{sites:{type:Array,required:!0},value:{type:String,required:!0}},computed:{site(){return _.findWhere(this.sites,{handle:this.value})}}};var A=function(){var t=this,s=t._self._c;return s("v-select",{staticClass:"text-sm",attrs:{value:t.site,clearable:!1,searchable:!1,"get-option-label":i=>t.__(i.name),options:t.sites},on:{input:function(i){return t.$emit("input",i)}}})},q=[],U=o(x,A,q,!1,null,null,null,null);const p=U.exports,O={mixins:[w],components:{SiteSelector:p},props:{createFormUrl:{type:String,required:!0},initialFormConfigs:{type:Array,required:!0},initialLocalizations:{type:Array,required:!0},initialSite:{type:String,required:!0}},data(){return{rows:_.clone(this.initialFormConfigs),columns:[{label:__("Form"),field:"form"},{label:__("Active"),field:"active"}],localizations:_.clone(this.initialLocalizations),site:this.initialSite}},methods:{localizationSelected(e){e.active||(this.loading=!0,this.$axios.get(e.url).then(t=>{const s=t.data;this.rows=s.formConfigs,this.localizations=s.localizations,this.site=e.handle,this.loading=!1}))}}};var k=function(){var t=this,s=t._self._c;return s("div",[s("header",{staticClass:"mb-6"},[s("div",{staticClass:"flex items-center"},[s("h1",{staticClass:"flex-1",domProps:{textContent:t._s(t.__("HubSpot"))}}),t.localizations.length>1?s("site-selector",{staticClass:"rtl:ml-4 ltr:mr-4",attrs:{sites:t.localizations,value:t.site},on:{input:t.localizationSelected}}):t._e(),s("a",{staticClass:"btn-primary",attrs:{href:t.createFormUrl},domProps:{textContent:t._s(t.__("Create Form"))}})],1)]),s("data-list",{attrs:{rows:t.rows,columns:t.columns}},[s("div",{staticClass:"card overflow-hidden p-0"},[s("data-list-table",{scopedSlots:t._u([{key:"cell-form",fn:function({row:i}){return[s("a",{attrs:{href:i.edit_url}},[t._v(t._s(i.title))])]}},{key:"actions",fn:function({row:i}){return[s("dropdown-list",[s("dropdown-item",{attrs:{text:t.__("Edit"),redirect:i.edit_url}})],1)]}}])})],1)])],1)},z=[],R=o(O,k,z,!1,null,null,null,null);const D=R.exports,E={components:{SiteSelector:p},props:{title:String,initialAction:String,initialDeleteUrl:String,initialListingUrl:String,blueprint:Object,initialMeta:Object,initialValues:Object,initialLocalizations:Array,initialSite:String},data(){return{localizing:!1,action:this.initialAction,deleteUrl:this.initialDeleteUrl,listingUrl:this.initialListingUrl,meta:_.clone(this.initialMeta),values:_.clone(this.initialValues),localizations:_.clone(this.initialLocalizations),site:this.initialSite,error:null,errors:{}}},computed:{isDirty(){return this.$dirty.has("base")}},methods:{clearErrors(){this.error=null,this.errors={}},save(){this.action&&(this.saving=!0,this.clearErrors(),this.$axios.patch(this.action,this.values).then(e=>{this.saving=!1,this.$toast.success(__("Saved")),this.$refs.container.saved(),this.$emit("saved",e)}).catch(e=>this.handleAxiosError(e)))},handleAxiosError(e){if(this.saving=!1,e.response&&e.response.status===422){const{message:t,errors:s}=e.response.data;this.error=t,this.errors=s,this.$toast.error(t)}else{const t=data_get(e,"response.data.message");this.$toast.error(t||e),console.log(e)}},localizationSelected(e){e.active||this.isDirty&&!confirm(__("Are you sure? Unsaved changes will be lost."))||(this.localizing=e.handle,window.history.replaceState({},"",e.url),this.$axios.get(e.url).then(t=>{const s=t.data;this.action=s.action,this.deleteUrl=s.deleteUrl,this.listingUrl=s.listingUrl,this.values=s.values,this.meta=s.meta,this.localizations=s.localizations,this.site=e.handle,this.localizing=!1,this.$nextTick(()=>this.$refs.container.clearDirtyState())}))}},created(){this.$keys.bindGlobal(["mod+s"],e=>{e.preventDefault(),this.save()})}};var L=function(){var t=this,s=t._self._c;return s("div",[s("header",{staticClass:"mb-6"},[s("div",{staticClass:"flex items-center"},[s("h1",{staticClass:"flex-1",domProps:{textContent:t._s(t.title)}}),t.deleteUrl?s("dropdown-list",{staticClass:"rtl:ml-2 ltr:mr-2"},[s("dropdown-item",{staticClass:"warning",attrs:{text:t.__("Delete Config")},on:{click:function(i){return t.$refs.deleter.confirm()}}},[s("resource-deleter",{ref:"deleter",attrs:{resourceTitle:t.title,route:t.deleteUrl,redirect:t.listingUrl}})],1)],1):t._e(),t.localizations.length>1?s("site-selector",{staticClass:"rtl:ml-4 ltr:mr-4",attrs:{sites:t.localizations,value:t.site},on:{input:t.localizationSelected}}):t._e(),s("button",{staticClass:"btn-primary min-w-100",domProps:{textContent:t._s(t.__("Save"))},on:{click:function(i){return i.preventDefault(),t.save.apply(null,arguments)}}})],1)]),s("publish-container",{ref:"container",attrs:{name:"base",blueprint:t.blueprint,meta:t.meta,errors:t.errors},scopedSlots:t._u([{key:"default",fn:function({setFieldValue:i,setFieldMeta:l}){return[s("publish-tabs",{on:{updated:i,"meta-updated":l}})]}}]),model:{value:t.values,callback:function(i){t.values=i},expression:"values"}})],1)},Q=[],j=o(E,L,Q,!1,null,null,null,null);const T=j.exports,N={mixins:[Fieldtype],inject:["storeName"],data(){return{fields:[]}},mounted(){this.refreshFields()},methods:{refreshFields(){this.$axios.get(cp_url("/hubspot/contact-properties")).then(e=>{this.fields=e.data}).catch(()=>{this.fields=[]})}}};var H=function(){var t=this,s=t._self._c;return s("div",{staticClass:"hubspot-contact-properties-fieldtype-wrapper"},[s("v-select",{attrs:{"append-to-body":"",clearable:!0,options:t.fields,reduce:i=>i.id,placeholder:t.__("Choose..."),searchable:!0},on:{input:function(i){return t.$emit("input",i)}},model:{value:t.value,callback:function(i){t.value=i},expression:"value"}})],1)},I=[],M=o(N,H,I,!1,null,null,null,null);const V=M.exports,K={mixins:[Fieldtype],inject:["storeName"],data(){return{fields:[]}},computed:{form(){return StatamicConfig.urlPath.split("/")[1]??""}},mounted(){this.refreshFields()},methods:{refreshFields(){this.$axios.get(cp_url(`/hubspot/form-fields/${this.form}`)).then(e=>{this.fields=e.data}).catch(()=>{this.fields=[]})}}};var B=function(){var t=this,s=t._self._c;return s("div",{staticClass:"statamic-form-fields-fieldtype-wrapper"},[s("v-select",{attrs:{"append-to-body":"",clearable:!0,options:t.fields,reduce:i=>i.id,placeholder:t.__("Choose..."),searchable:!0},on:{input:function(i){return t.$emit("input",i)}},model:{value:t.value,callback:function(i){t.value=i},expression:"value"}})],1)},J=[],W=o(K,B,J,!1,null,null,null,null);const X=W.exports;Statamic.booting(()=>{Statamic.$components.register("hubspot-listing",D),Statamic.$components.register("hubspot-publish-form",T),Statamic.$components.register("hubspot_contact_properties-fieldtype",V),Statamic.$components.register("statamic_form_fields-fieldtype",X)});
